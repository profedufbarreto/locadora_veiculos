<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Cadastro - Locadora 2026</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://unpkg.com/imask"></script>
    <style>
        .cadastro-container { max-width: 800px; margin: 30px auto; padding: 20px; background: #fff; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        .form-section { border-bottom: 1px solid #eee; margin-bottom: 20px; padding-bottom: 20px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        input { padding: 12px; border: 1px solid #ddd; border-radius: 5px; width: 100%; box-sizing: border-box; margin-top: 5px; }
        label { font-weight: bold; font-size: 0.9rem; color: #555; }
        .btn-finalizar { background: #27ae60; color: white; border: none; padding: 15px; width: 100%; border-radius: 5px; cursor: pointer; font-size: 1.1rem; }
    </style>
</head>
<body>
    <div class="cadastro-container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div style="padding: 15px; margin-bottom: 20px; border-radius: 4px; 
                        background-color: {{ '#d4edda' if 'sucesso' in message.lower() or not category else '#f8d7da' }}; 
                        color: {{ '#155724' if 'sucesso' in message.lower() or not category else '#721c24' }}; 
                        border: 1px solid {{ '#c3e6cb' if 'sucesso' in message.lower() or not category else '#f5c6cb' }};
                        text-align: center; font-weight: bold;">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        <h2>Criar Conta de Cliente</h2>
        <form action="{{ url_for('cadastro') }}" method="POST novalidate">
            
            <div class="form-section">
                <h3>1. Dados Pessoais</h3>
                <div class="grid-2">
                    <div>
                        <label>Nome Completo</label>
                        <input type="text" name="nome" required>
                    </div>
                    <div>
                        <label>CPF</label>
                        <input type="text" id="cpf" name="cpf" placeholder="000.000.000-00" required>
                    </div>
                </div>
                <div class="grid-2">
                    <div>
                        <label>Data de Nascimento</label>
                        <input type="text" id="nascimento" name="data_nascimento" placeholder="00/00/0000" required>
                    </div>
                    <div>
                        <label>E-mail (Será seu Login)</label>
                        <input type="email" name="email" required>
                    </div>
                </div>
                <div class="grid-2">
                    <div>
                        <label>Senha</label>
                        <input type="password" name="senha" required>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>2. Endereço</h3>
                <div class="grid-3">
                    <div>
                        <label>CEP</label>
                        <input type="text" id="cep" name="cep" placeholder="00000-000" onblur="buscaCEP()" required>
                    </div>
                    <div style="grid-column: span 2;">
                        <label>Rua</label>
                        <input type="text" id="rua" name="rua" readonly required>
                    </div>
                </div>
                <div class="grid-3">
                    <div>
                        <label>UF</label>
                        <input type="text" id="uf" name="uf" readonly required>
                    </div>
                    <div>
                        <label>Cidade</label>
                        <input type="text" id="cidade" name="cidade" readonly required>
                    </div>
                    <div>
                        <label>Número</label>
                        <input type="text" name="numero" required>
                    </div>
                </div>
                <div>
                    <label>Complemento / Obs (Opcional)</label>
                    <input type="text" name="complemento">
                </div>
            </div>

            <div class="form-section">
                <h3>3. Pagamento Preferencial</h3>
                <select name="pagamento_pref" style="padding: 10px; width: 100%;">
                    <option value="">Escolher na hora do aluguel</option>
                    <option value="cartao">Cartão de Crédito</option>
                    <option value="pix">PIX</option>
                </select>
            </div>

            <button type="submit" class="btn-finalizar">Finalizar Cadastro</button>
        </form>
    </div>

    <script>
        // MÁSCARAS
        IMask(document.getElementById('cpf'), { mask: '000.000.000-00' });
        IMask(document.getElementById('nascimento'), { mask: '00/00/0000' });
        IMask(document.getElementById('cep'), { mask: '00000-000' });

        // BUSCA CEP AUTOMÁTICA
        function buscaCEP() {
            let cep = document.getElementById('cep').value.replace(/\D/g, '');
            if (cep.length === 8) {
                fetch(`https://viacep.com.br/ws/${cep}/json/`)
                    .then(response => response.json())
                    .then(data => {
                        if (!data.erro) {
                            document.getElementById('rua').value = data.logradouro;
                            document.getElementById('uf').value = data.uf;
                            document.getElementById('cidade').value = data.localidade;
                        } else {
                            alert("CEP não encontrado.");
                        }
                    });
            }
        }
    </script>
</body>
</html>